{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2d73259f_e0177f1f",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 32,
      "author": {
        "id": 1000733
      },
      "writtenOn": "2022-01-21T03:03:03Z",
      "side": 1,
      "message": "Given that the \u0027master\u0027 branch reference (and lines numbers in it) may change over time, it would be more future-proof to link to the line within a specific revision (e.g. https://github.com/openbmc/entity-manager/blob/9dc2cc5387bb2902128a26d8426d99fc1aee8854/src/FruDevice.cpp#L197), or perhaps just to the commit that introduced that code (https://github.com/openbmc/entity-manager/commit/2d681f6fdec02b2f56d9155117c4830703026cb0).",
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9d4cc5a3_684fc275",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 32,
      "author": {
        "id": 1001338
      },
      "writtenOn": "2022-01-24T03:40:18Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "2d73259f_e0177f1f",
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "017ef8ae_08a19353",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-17T17:36:43Z",
      "side": 1,
      "message": "I have no interest in supporting per-machine services in entity-manager.  If you need a per-machine service, write an entity-manager reactor, which can be be per-machine.",
      "range": {
        "startLine": 61,
        "startChar": 55,
        "endLine": 62,
        "endChar": 40
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "bbb2e9e3_fafd98ba",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2021-12-21T14:36:45Z",
      "side": 1,
      "message": "If I understood your statement properly i could think of following design:\n\nJust creating a new reactor deamon in entity-manager, through this reactor deamon will read and parse the ncsi command and get the output as 8-bit or 16-bit. Then it will update the 8-bit or 16 bit device byte type in Dbus interfaces of FRU device and read from it.\n\nQuestion:Is it fine to have the deamon(detector EEPROM) in entity-manager?",
      "parentUuid": "017ef8ae_08a19353",
      "range": {
        "startLine": 61,
        "startChar": 55,
        "endLine": 62,
        "endChar": 40
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e91734fe_e509155a",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-21T19:51:23Z",
      "side": 1,
      "message": "\u003e If I understood your statement properly i could think of following design:\n\u003e \n\u003e Just creating a new reactor deamon in entity-manager,\n\nIt would not belong in entity-manager.  Entity-manager is for common code.\n\n\u003e through this reactor deamon will read and parse the ncsi command and get the output as 8-bit or 16-bit.\n\nAH, now I understand.  Let me make sure I have it right.\n\n1. BMC reads the NCSI ID of the NIC\n2. The NCSI id will determine if the NIC has a 16 bit or 8 bit eeprom\n\n\nThat makes more sense.  In that case, your flow would be:\n\n1. Update NCSId to expose an appropriate dbus API for determining the \"model\" or \"ID\" of the card.  You might need to invent a new interface here.\n2. Write an EM config file that uses that dbus API for its probe statement.\n3. In the EM config file, add a \"Size\" flag under the Type: \"EEPROM\" field.\n4. Update FruDevice to check EM configs, and lookup the size field appropriately if it\u0027s defined in an EM config.\n\n\nThe advantage of the above design is that there\u0027s no new platform-specific code, and it\u0027s reusing most of the infrastructure that exists already.\n\n\u003e Then it will update the 8-bit or 16 bit device byte type in Dbus interfaces of FRU device and read from it.\n\u003e \n\u003e Question:Is it fine to have the deamon(detector EEPROM) in entity-manager?\n\nIn the above what I\u0027ve written, there are no new daemons here.\n\nNCSID exists (although would need to be promoted out of the meta-google repo if more people are going to use it)\nhttps://github.com/openbmc/openbmc/blob/master/meta-google/recipes-google/ncsi/ncsid_git.bb\n\nThat would be the thing that exposes the NCSI device model number.",
      "parentUuid": "bbb2e9e3_fafd98ba",
      "range": {
        "startLine": 61,
        "startChar": 55,
        "endLine": 62,
        "endChar": 40
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4806e471_032c5cc2",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 62,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2022-01-12T07:56:09Z",
      "side": 1,
      "message": "ack.This flow would be good, we can get the eeprom single byte or two byte by using get info or get version command from ncsid.\n\ndbus api can be created for this ncsid and it can be probed by entity-manager config, and fru device can the eeprom type.",
      "parentUuid": "e91734fe_e509155a",
      "range": {
        "startLine": 61,
        "startChar": 55,
        "endLine": 62,
        "endChar": 40
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b3c2752_b9b3277e",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 65,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-17T17:36:43Z",
      "side": 1,
      "message": "Please avoid making this a script.  They are difficult to debug and maintain over time.",
      "range": {
        "startLine": 65,
        "startChar": 51,
        "endLine": 65,
        "endChar": 57
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "31da2552_a58ff7de",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 65,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2021-12-21T14:36:45Z",
      "side": 1,
      "message": "Ack.Based on the first review comment input/suggestions this can be concluded.",
      "parentUuid": "0b3c2752_b9b3277e",
      "range": {
        "startLine": 65,
        "startChar": 51,
        "endLine": 65,
        "endChar": 57
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "71ca16a3_dc8734d6",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 66,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-17T17:36:43Z",
      "side": 1,
      "message": "I\u0027m not following this step.  If you don\u0027t know if the eeprom is 8 bit or 16 bit, how does this script suddenly bypass the \"detect 16 bit eeprom\" problem?  Won\u0027t this script have the same issue as the FruDevice code does?",
      "range": {
        "startLine": 65,
        "startChar": 75,
        "endLine": 66,
        "endChar": 52
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d396b592_3663f3ef",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 66,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2021-12-21T14:36:45Z",
      "side": 1,
      "message": "The script doesn\u0027t read the EEPROM directly, There are some other mechanism to find out whether this will have a 8-bit or 16-bit EEPROM. this will read by the NIC manufacturer information using nisi command, using this command ncsi-netlink --info -x 2 -p 0 -c 0  will get the output like this \n\nGet Info , PACKAGE :  0, IFINDEX :  2\nPackage has id : 0\nChannel Active : 0\nChannel Major Version : f1f1f000\nChannel Minor Version : 0\nChannel Version Str :mlx0.1\nChannel Link State : 2f\nActive Vlan ids\n\nbased on this information, we are getting 8 bit or 16 bit type using manufacturer information",
      "parentUuid": "71ca16a3_dc8734d6",
      "range": {
        "startLine": 65,
        "startChar": 75,
        "endLine": 66,
        "endChar": 52
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4418aec6_1157add4",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 66,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-21T19:51:23Z",
      "side": 1,
      "message": "Now I understand.  See my reply on the previous comment about how you could make this work in an entity-manager system.",
      "parentUuid": "d396b592_3663f3ef",
      "range": {
        "startLine": 65,
        "startChar": 75,
        "endLine": 66,
        "endChar": 52
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "10b45370_3e7e7491",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 66,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2022-01-12T07:56:09Z",
      "side": 1,
      "message": "ack.",
      "parentUuid": "4418aec6_1157add4",
      "range": {
        "startLine": 65,
        "startChar": 75,
        "endLine": 66,
        "endChar": 52
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1ecda658_bcc04a20",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-17T17:36:43Z",
      "side": 1,
      "message": "To repeat, if you want a platform-specific service, write and maintain a platform specific service.  Dbus is your extension point and interface there;  If you want to reuse code from FruDevice for it, abstract it to a library (a lot of that work has already been done).  I\u0027m not interested in having a plugin system for FruDevice, which is intended to be self-contained.",
      "range": {
        "startLine": 70,
        "startChar": 0,
        "endLine": 72,
        "endChar": 58
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "dc61ee9f_06b7b5cc",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 72,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2021-12-21T14:36:45Z",
      "side": 1,
      "message": "Ack.Based on the first review comment input/suggestions this can be concluded.",
      "parentUuid": "1ecda658_bcc04a20",
      "range": {
        "startLine": 70,
        "startChar": 0,
        "endLine": 72,
        "endChar": 58
      },
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "1a9dc133_a1f4f31d",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 76,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-17T17:36:43Z",
      "side": 1,
      "message": "In this flow, you\u0027ve basically described how this should work, you\u0027ve just added a number of pieces that are extra and not needed.\n\n1. In the \"Type\": \"eeprom\" entry for a given device, include a parameter called \"size\" that can determine whether the eeprom is 16 bit or 8 bit.\n2. Determine how to detect the \"is 16 bit\" of a given device without pre-defined knowledge of said device, or attach the relevant information to the baseboard configuration for something like \"Eeprom hint\"\n3. Add the backward path to FruDevice such that FruDevice looks at the size parameter, and uses that to set the 16bitness of the part.",
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f3acae68_08181fbc",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 76,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2021-12-21T14:36:45Z",
      "side": 1,
      "message": "We have a json file for baseboard FRU and we have a separate json file for each NIC card in entity-manager, if particular  NIC card has been detected then it will load the corresponding json config file and read the EEPROM information, EEPROM config can be detected at run time based on the loaded FRU NIC.\n\nwe have a NIC card slot, that will support Mellanox NIC card or Broadcom NIC card, Both are having different EEPROM configuration. we have to detect 8-bit or 16-bit EEPROM type before load the FRU NIC. This EEPROM byte detection is platform specific.",
      "parentUuid": "1a9dc133_a1f4f31d",
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6da47a52_d9324978",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 76,
      "author": {
        "id": 1000153
      },
      "writtenOn": "2021-12-21T19:51:23Z",
      "side": 1,
      "message": "\u003e We have a json file for baseboard FRU and we have a separate json file for each NIC card in entity-manager, if particular  NIC card has been detected then it will load the corresponding json config file and read the EEPROM information, EEPROM config can be detected at run time based on the loaded FRU NIC.\n\nYep, you got it.\n\n\u003e \n\u003e we have a NIC card slot, that will support Mellanox NIC card or Broadcom NIC card, Both are having different EEPROM configuration. we have to detect 8-bit or 16-bit EEPROM type before load the FRU NIC.\n\nSlight change in wording: You have to detect the MODEL of the card.  From there entity-manager can generally configure the size of the eeprom, which doesn\u0027t need to be platform specific.\n\n\u003e This EEPROM byte detection is platform specific.\n\nIMO, based on what you\u0027ve written, I don\u0027t think it is.  If I put a 16 bit eeprom mellonox card into any system, I\u0027d like it to parse correctly, and using NCSI seems like a nice generic way to do that model detection.",
      "parentUuid": "f3acae68_08181fbc",
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "20244d23_a91e47e3",
        "filename": "designs/EEPROM-byte-type-identification.md",
        "patchSetId": 2
      },
      "lineNbr": 76,
      "author": {
        "id": 1001139
      },
      "writtenOn": "2022-01-12T07:56:09Z",
      "side": 1,
      "message": "ack. As per flow what you are suggest, this will be generic way to detect the model ID in ncsid.",
      "parentUuid": "6da47a52_d9324978",
      "revId": "ab2952761d7bfc6099dd70cb29dea00242ee9040",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}