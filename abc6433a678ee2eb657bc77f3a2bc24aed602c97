{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2e4c81a1_6b13232f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1001712
      },
      "writtenOn": "2025-02-10T08:50:47Z",
      "side": 1,
      "message": "Everything looks to be clearly defined now üëç",
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6f63fd82_155a5901",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 10
      },
      "lineNbr": 0,
      "author": {
        "id": 1002135
      },
      "writtenOn": "2025-02-11T00:34:57Z",
      "side": 1,
      "message": "Looks good to me, use cases from PLDM can be found [here] (WIP).\n\n[here]: https://gerrit.openbmc.org/c/openbmc/pldm/+/76704",
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3264a9f0_7719f1c4",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 260,
      "author": {
        "id": 1000005
      },
      "writtenOn": "2025-02-11T11:25:17Z",
      "side": 1,
      "message": "@paligill@gmail.com One detail missing is that there is a configuration json provided to the CodeUpdater. Why is this not part of the EM configuration?\n\nhttps://gerrit.openbmc.org/c/openbmc/pldm/+/76704/20/configurations/fw-update-conditions/yv4.json",
      "range": {
        "startLine": 259,
        "startChar": 28,
        "endLine": 260,
        "endChar": 32
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "45d64423_f18dc4e9",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 260,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-02-12T08:59:30Z",
      "side": 1,
      "message": "\u003e @paligill@gmail.com One detail missing is that there is a configuration json provided to the CodeUpdater. Why is this not part of the EM configuration?\n\u003e \n\nI remember this question was brought up both by you and Alexander earlier. It was heavily discussed with @spinler@us.ibm.com (EM Maintainer) on https://gerrit.openbmc.org/c/openbmc/docs/+/75500/comment/c8ef7c62_9eb33e40/. Based on discussion we went with implicit ServiceNames (based on device names) for pre/post conditions.\n\nIf you still have some questions around the EM configuration use, please reply on https://gerrit.openbmc.org/c/openbmc/docs/+/75500/comment/c8ef7c62_9eb33e40/ and we can open that comment thread for further discussion. It has good context and history.\n\nI will mark this comment as resolved for now.",
      "parentUuid": "3264a9f0_7719f1c4",
      "range": {
        "startLine": 259,
        "startChar": 28,
        "endLine": 260,
        "endChar": 32
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ec320861_747dd465",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 260,
      "author": {
        "id": 1000005
      },
      "writtenOn": "2025-02-14T19:41:05Z",
      "side": 1,
      "message": "Got it, understood the reasoning behind not pursuing with EM.\n\nThe comment\u0027s intention is PLDM patch is using config JSON for pre and post and it is not documented here. \n\nhttps://gerrit.openbmc.org/c/openbmc/pldm/+/76704/20/configurations/fw-update-conditions/yv4.json",
      "parentUuid": "45d64423_f18dc4e9",
      "range": {
        "startLine": 259,
        "startChar": 28,
        "endLine": 260,
        "endChar": 32
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b541191b_18ca9d76",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 260,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-02-14T20:03:33Z",
      "side": 1,
      "message": "\u003e Got it, understood the reasoning behind not pursuing with EM.\n\u003e \n\u003e The comment\u0027s intention is PLDM patch is using config JSON for pre and post and it is not documented here. \n\u003e \n\u003e https://gerrit.openbmc.org/c/openbmc/pldm/+/76704/20/configurations/fw-update-conditions/yv4.json\n\nThis PLDM patch is WIP and based on original design proposal which has changed over the course of this PR. \n\n@unive.tien.wiwynn@gmail.com is in the reviewer list of this change. \n@unive.tien.wiwynn@gmail.com Please review the latest and let me know if there are any concerns and once this PR is approved and merged, can you please modify the PLDM patch to reflect it. \n\nMarking this comment as resolved for now.",
      "parentUuid": "ec320861_747dd465",
      "range": {
        "startLine": 259,
        "startChar": 28,
        "endLine": 260,
        "endChar": 32
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0d48b190_94679d98",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 267,
      "author": {
        "id": 1000005
      },
      "writtenOn": "2025-02-11T11:25:17Z",
      "side": 1,
      "message": "@paligill@gmail.com Can we just name this \u003cabc\u003e_PreUpdate@.service? This could be common across many devices.",
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b5bd0c8a_7f3aef9c",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 267,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-02-12T08:59:30Z",
      "side": 1,
      "message": "We named it \u003cDeviceName\u003e_XXX, so we don\u0027t have to rely on any external source to specify it, but implicitly derive it from actual device name (I have captured in doc what does DeviceName map to).\n\nThe whole intent of these hooks is that they are device specific (otherwise they would have been in common code). But one can also say they can be common for some devices, as you brought it up. Do you have any specific use case in mind for it being common for some devices?\n\nAs a solution for your ask, which is around code reuse for common stuff one can also install the same service (via meson) with different names which can be easily achieved in openbmc/openbmc repo where most of platform specific stuff resides. \n\nPlease let me know your thoughts.",
      "parentUuid": "0d48b190_94679d98",
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2cec410f_09ff5f4c",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 267,
      "author": {
        "id": 1000005
      },
      "writtenOn": "2025-02-14T19:41:05Z",
      "side": 1,
      "message": "\u003eDo you have any specific use case in mind for it being common for some devices?\n\n1. Chassis power on/off is a common case before the start of the update.\n2. Reset the device after the update using GPIO pin reset.\n\nCan `Device Name` be chassis object name? For eg: if the associated chassis for the component is CPLD_0, CPLD_0_PreUpdate.service etc.\n\nAlso if there are multiple components for a device, is this design flexible to have pre and post after all the components like:\n\n1. PreUpdate.service\n2. Component 1 update\n3. Component 2 update\n4. Component n update\n5. Postupdate.seervice",
      "parentUuid": "b5bd0c8a_7f3aef9c",
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "81434a48_4ee6c2fc",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 267,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-02-18T00:35:20Z",
      "side": 1,
      "message": "\u003e \u003eDo you have any specific use case in mind for it being common for some devices?\n\u003e \n\u003e 1. Chassis power on/off is a common case before the start of the update.\n\u003e 2. Reset the device after the update using GPIO pin reset.\n\nNot sure what you mean by chassis power on/off here, probably you are referring to the host? If yes, then both the #1 and #2 have been considered for the design.\n\n\u003e \n\u003e Can `Device Name` be chassis object name? For eg: if the associated chassis for the component is CPLD_0, CPLD_0_PreUpdate.service etc.\n\n`Device Name` maps to `ASCII Model` of downstream device in case of PLDM device. Thats how the plan is to compute the Pre and Post conditions implicitly. If you want to use arbitrary names for pre/post conidtions, then we have to go back to my original proposal of defining the JSON configuration so platform can specify it and CodeUpdater can parse (since we cannot specify it in EM as already discussed) and create this state for which condition to invoke for which kind of device. Seems like thats what you are looking for?\n\n\u003e \n\u003e Also if there are multiple components for a device, is this design flexible to have pre and post after all the components like:\n\u003e \n\u003e 1. PreUpdate.service\n\u003e 2. Component 1 update\n\u003e 3. Component 2 update\n\u003e 4. Component n update\n\u003e 5. Postupdate.seervice\n\nI am not imposing any restriction in this patch on why you cannot have it.",
      "parentUuid": "2cec410f_09ff5f4c",
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "85d251ba_de84faf5",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 279,
      "author": {
        "id": 1000005
      },
      "writtenOn": "2025-02-11T11:47:41Z",
      "side": 1,
      "message": "Why is this a `warning`, pre and post is optional right?",
      "range": {
        "startLine": 279,
        "startChar": 53,
        "endLine": 279,
        "endChar": 60
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "c290a1c4_42134529",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 279,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-02-12T08:59:30Z",
      "side": 1,
      "message": "Yes, pre and post conditions are optional but at the same time there was a ask brought up by @alexander.hansen@9elements.com quoted below -\n\n\"\n the user has setup a service and then there is no response from the code updater and unclear if the code updater knows about the service. Since those services will be an interface also for downstream.\n \"\n \nSo, to accommodate this + the optional part at same time, a middle ground was needed. And that middle ground is this warning message to warn the user that a pre/post service hasn\u0027t been run that they might have implemented. This shouldn\u0027t break the flow but warn the user in case they debug via journalctl.",
      "parentUuid": "85d251ba_de84faf5",
      "range": {
        "startLine": 279,
        "startChar": 53,
        "endLine": 279,
        "endChar": 60
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0b04f545_5fb3fac1",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 279,
      "author": {
        "id": 1000005
      },
      "writtenOn": "2025-02-14T19:41:05Z",
      "side": 1,
      "message": "\u003ethere is no response from the code updater\nWhat is that code updater has to respond for in this case?\n\n\u003eunclear if the code updater knows about the service.\nGetUnitFileState to know if a service exists and StartUnit/JobRemoved to watch the lifetime of pre and post service. * What is that code updater doesn\u0027t know about*\n\nWarning is misleading if GetUnitFileState says a service doesn\u0027t exist, if there are failures in starting/completion then it is acceptable.\n\nHow will be the RF update task be updated if the pre or post service fails?",
      "parentUuid": "c290a1c4_42134529",
      "range": {
        "startLine": 279,
        "startChar": 53,
        "endLine": 279,
        "endChar": 60
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8632ea13_a5222da5",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 279,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-02-18T00:35:20Z",
      "side": 1,
      "message": "\u003e \u003ethere is no response from the code updater\n\n\u003e What is that code updater has to respond for in this case?\n\nMy understanding of what @alexander.hansen@9elements.com meant by this is if the CodeUpdater doesn\u0027t execute the pre/post service even though the service has specified and packaged it, so some signal is needed in that case to show the service didn\u0027t run.\n\n\u003e \n\u003e \u003eunclear if the code updater knows about the service.\n\u003e GetUnitFileState to know if a service exists and StartUnit/JobRemoved to watch the lifetime of pre and post service. * What is that code updater doesn\u0027t know about*\n\u003e \n\u003e Warning is misleading if GetUnitFileState says a service doesn\u0027t exist, if there are failures in starting/completion then it is acceptable.\n\nCodeUpdater has no info if the service exists or not, as its discovered at runtime using GetUnitFileState (ServiceName created implicitly using `Device Name`), a signal is given to the user if the service is not found, which is using this warning message. The failure is an error condition, which would actually fail the update.\n\n\u003e \n\u003e How will be the RF update task be updated if the pre or post service fails?\n\nIf Pre/Post condition exists, then for ApplyTime \u003d\u003d Immediate, any failure in Pre/Post will cause ActivationStatus failure which accordingly update the RF state. For ApplyTime \u003d\u003d OnReset, only pre condition applies and any failure in that will mark the ActivationStatus as failed, which accordingly update the RF state.\nOn how ActivationStatus gets handled in BMCWeb, you can refer to UpdateService in BMCWeb.\n\n\n@rushtotom@gmail.com I think i have answered your questions to much depth, so i am marking this one as resolved. Your main question was around Warning message, so if that is still a concern, we need to move to the JSON configuration specified by CodeUpdater (so it can be known before hand if a pre/post condition is expected and handle it accordingly) which we are already discussing here https://gerrit.openbmc.org/c/openbmc/docs/+/75500/comment/0d48b190_94679d98/. So, lets move the conversation to that thread.",
      "parentUuid": "0b04f545_5fb3fac1",
      "range": {
        "startLine": 279,
        "startChar": 53,
        "endLine": 279,
        "endChar": 60
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "07671bc1_4e6453cd",
        "filename": "designs/code-update.md",
        "patchSetId": 10
      },
      "lineNbr": 279,
      "author": {
        "id": 1001758
      },
      "writtenOn": "2025-02-18T00:36:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8632ea13_a5222da5",
      "range": {
        "startLine": 279,
        "startChar": 53,
        "endLine": 279,
        "endChar": 60
      },
      "revId": "abc6433a678ee2eb657bc77f3a2bc24aed602c97",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}