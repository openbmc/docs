{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "0e927b3e_19b67483",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2024-08-28T02:45:16Z",
      "side": 1,
      "message": "Hi @Patrick NC Lin,\n\nSeems this is a bit historic and was probably defined when watchdogs were not typically integrated. Documentation/watchdog/watchdog-api.rst says:\n`Card previously reset the CPU`\n\nAccording to `reset the CPU` that similar to `Power On Reset` means CPU reset and all values be reset to default. That’s why we use this specific `WDIOF_CARDRESET` to identify `POR`, not `WDIOF_EXTERN1` or `WDIOF_EXTERN2`.\n\nIf BMC have more than one watchdog resets support, we need to know which watchdog reset used on platform through watchdog driver DTS. Ex: `ext1-reset-type \u003d “wd0”` (or “wd1”, “wd2” etc.). Thus, we define WDIOF_EXTERN1 as watchdog reset.\n\nIf BMC have more than one software resets support, we also need to know which software reset used on platform through watchdog driver DTS. Ex: `ext2-reset-type \u003d “sw1”` (or “sw2”, “sw3” etc.). Thus, we define WDIOF_EXTERN2 as software reset.\n\nHowever, the WDIOF_EXTERN2 we haven’t implemented it yet in phosphor-state-manager and phosphor-dbus-interfaces. We might upstream it if we have conclusion. Thanks.",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "123155f7_c8ef6815",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1002129
      },
      "writtenOn": "2024-08-29T07:07:27Z",
      "side": 1,
      "message": "Hi @Patrick Williams, what are your thoughts on this?\n\nHi @Tim Lee, thank you for your response. I will discuss this with others and get back to you with our conclusions.",
      "parentUuid": "0e927b3e_19b67483",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "112b8ebe_7bf9547c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-08-29T19:23:49Z",
      "side": 1,
      "message": "Tim, as best I can tell, this whole discussion of Nuvoton support is from an unsubmitted patch, isn\u0027t it?  (https://github.com/Nuvoton-Israel/linux/commit/fdaeb53a7ca6b378315f0a584ff42a61efdec4d3). I don\u0027t see any indication that this was submitted to the LKML.\n\nI\u0027ve tried to read the upstream drivers in Linux. From what I can tell \"Power On Reset\" is typically modeled by a 0 in the status.  CARDRESET is typically used for the watchdog itself triggering and causing a reset.  (The current Aspeed chip uses this, pcwd.c uses this, via_wdt.c uses this.).\n\nI think the confusion in the Nuvoton side is that you have a signal in your watchdog hardware called \"card reset\" which is used to indicate POR state.  Tomer mapped this to the WDIOF_CARDRESET, since it has the same name, but that isn\u0027t generally the upstream approach.",
      "parentUuid": "123155f7_c8ef6815",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "6d35b8c9_2523ae8a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 1000294
      },
      "writtenOn": "2024-09-04T02:50:05Z",
      "side": 1,
      "message": "@Patrick Williams\n\nThanks for your feedback. Indeed, Nuvoton watchdog driver support reset cause for Power-On-Reset, Watchdog reset and Software reset. The patch is ready to submit by Tomer recently. For Kernel side, watchdog driver need to translate the reason to Userspace and customer can just change DTS `card-reset-type \u003d \"wdX\"` and `ext1-reset-type \u003d \"porst\"` to decide which reset cause through Nuvoton watchdog driver.\n\nFor OpenBMC side, we can help to exchange WDIOF_CARRESET and WDIOF_EXTERN1 in phosphor-state-manager and phosphor-dbus-interfaces if we have conclusion. Thanks.",
      "parentUuid": "112b8ebe_7bf9547c",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "bc1b8048_ed164d63",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 12,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2024-09-03T21:27:06Z",
      "side": 1,
      "message": "High level I think it would be great to have more details on BMC reboots, especially unexpected ones.",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d53488f5_af94254f",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 27,
      "author": {
        "id": 1000004
      },
      "writtenOn": "2024-09-03T21:27:06Z",
      "side": 1,
      "message": "Is this even possible with the existing hardware we have (i.e. AST2500, AST2600?). Do we have aspeed agreement to write this driver? Either way, I think a requirement is we have a way to stay backwards compatible.",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "40b5bae8_90e50f62",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 71,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-08-20T11:41:08Z",
      "side": 1,
      "message": "I suspect this is going to be an issue for some existing hardware designs.  CARDRESET was \"power on reset\" because, that\u0027s what a CARDRESET is suppose to show, right?  Why are we using that for a watchdog now an using EXTERN2 as something other than the watchdog?",
      "range": {
        "startLine": 64,
        "startChar": 0,
        "endLine": 71,
        "endChar": 11
      },
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a196a652_385a58f6",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 71,
      "author": {
        "id": 1002129
      },
      "writtenOn": "2024-08-23T00:46:32Z",
      "side": 1,
      "message": "In the kernal documentation, CARDRESET means that the last reboot was caused by the watchdog card. That\u0027s why we recommend making this change. I will send an email to Tim Lee and ask his opinion on this.",
      "parentUuid": "40b5bae8_90e50f62",
      "range": {
        "startLine": 64,
        "startChar": 0,
        "endLine": 71,
        "endChar": 11
      },
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "cd36da50_0f6461e4",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 82,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-08-20T11:41:08Z",
      "side": 1,
      "message": "What is a \"System Event Log\"?  This is an IPMI term.  I assume you\u0027re going to be making a new record per https://github.com/openbmc/docs/blob/master/designs/event-logging.md ?",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 82,
        "endChar": 35
      },
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "004d56b0_d4b71777",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 82,
      "author": {
        "id": 1002129
      },
      "writtenOn": "2024-08-23T00:46:32Z",
      "side": 1,
      "message": "You’re right. I will correct my wording.",
      "parentUuid": "cd36da50_0f6461e4",
      "range": {
        "startLine": 79,
        "startChar": 0,
        "endLine": 82,
        "endChar": 35
      },
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d737f3fc_9775f834",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 89,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-08-20T11:41:08Z",
      "side": 1,
      "message": "This is the opposite of intuitive to me...",
      "range": {
        "startLine": 88,
        "startChar": 37,
        "endLine": 89,
        "endChar": 56
      },
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "96c2cc5a_03f3cab5",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 89,
      "author": {
        "id": 1002129
      },
      "writtenOn": "2024-08-23T00:46:32Z",
      "side": 1,
      "message": "I will send an email to Tim Lee and discuss with him the correct usage of WDIOF_CARDRESET.",
      "parentUuid": "d737f3fc_9775f834",
      "range": {
        "startLine": 88,
        "startChar": 37,
        "endLine": 89,
        "endChar": 56
      },
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5321c549_72902bc2",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 90,
      "author": {
        "id": 1000000
      },
      "writtenOn": "2024-08-20T11:41:08Z",
      "side": 1,
      "message": "I\u0027ve looked at the kernel documentation and maybe CARDRESET _is_ suppose to be used for the watchdog reset:\n\n```\n\t\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\t\t\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\tWDIOF_CARDRESET\t\tCard previously reset the CPU\n\t\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\t\t\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\u003d\n\nThe last reboot was caused by the watchdog card\n```\n\nSee https://github.com/openbmc/linux/blob/6e4436539ae182dc86d57d13849862bcafaa4709/Documentation/watchdog/watchdog-api.rst#environmental-monitoring\n\nWe will need to get alignment from existing upstream users as to why EXTERN1 was previously used for this.  It looks like the code in phosphor-state-manager was added by Tim Lee from Nuvoton.",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "17d6bd0f_e7572797",
        "filename": "designs/bmc-reboot-cause-update.md",
        "patchSetId": 4
      },
      "lineNbr": 90,
      "author": {
        "id": 1002129
      },
      "writtenOn": "2024-08-23T00:46:32Z",
      "side": 1,
      "message": "As you mentioned, we reached this conclusion based on that document. I will send an email to Tim Lee, asking him to join the discussion and update the results here.",
      "parentUuid": "5321c549_72902bc2",
      "revId": "8d8738f76a3cca16fce8ea520f1ea6988c6d821d",
      "serverId": "adbd0a64-1f21-4d83-b585-671fe73cb6e4"
    }
  ]
}